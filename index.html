<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
  <title>í•œì„¸ëŒ€í•™êµ ìˆ˜ê°•ì‹ ì²­</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; }
    body { 
      font-family: 'ë§‘ì€ ê³ ë”•', 'ë‹ì›€', sans-serif;
      font-size: 12px;
      color: #333;
      background: #fff;
    }

    /* ì»¨í…Œì´ë„ˆ */
    .container {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
    }

    /* í—¤ë” */
    .header {
      background: #fff;
      border-bottom: 1px solid #ddd;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header .is-left {
      display: flex;
      align-items: center;
      gap: 20px;
      font-size: 13px;
    }
    .header .is-left span:first-child {
      font-size: 17px;
      font-weight: 600;
      letter-spacing: -1px;
    }
    .header .is-left .title {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #666;
    }
    .header .is-left .title button {
      padding: 3px 8px;
      border: 1px solid #ccc;
      background: #f8f8f8;
      cursor: pointer;
      font-size: 11px;
      border-radius: 2px;
    }

    .header .is-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .header .settings-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 20px;
      padding: 5px;
    }

    /* ì„¤ì • ëª¨ë‹¬ */
    #settings-modal {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    #settings-modal > div {
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      min-width: 400px;
    }
    #settings-modal .title { 
      font-size: 18px; 
      font-weight: bold; 
      margin-bottom: 20px;
      border-bottom: 2px solid #1976d2;
      padding-bottom: 10px;
    }
    .settings-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      padding: 10px 0;
    }
    .settings-item label {
      font-weight: 600;
      color: #333;
      font-size: 13px;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
      border-radius: 24px;
    }
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .toggle-slider {
      background-color: #1976d2;
    }
    input:checked + .toggle-slider:before {
      -webkit-transform: translateX(26px);
      -ms-transform: translateX(26px);
      transform: translateX(26px);
    }
    .grade-select {
      padding: 6px 10px;
      border: 1px solid #bbb;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }
    #settings-modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
      border-top: 1px solid #eee;
      padding-top: 20px;
    }
    #settings-modal-buttons button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
    }
    #settings-modal-buttons .cancel-btn {
      background: #f0f0f0;
      color: #333;
    }
    #settings-modal-buttons .cancel-btn:hover {
      background: #e0e0e0;
    }
    #settings-modal-buttons .confirm-btn {
      background: #1976d2;
      color: #fff;
    }
    #settings-modal-buttons .confirm-btn:hover {
      background: #1565c0;
    }

    /* ë°”ë”” */
    .body {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ì™¼ìª½ ë„¤ë¹„ê²Œì´ì…˜ */
    .nav {
      width: 160px;
      background: #f5f5f5;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
    }
    .nav .btn-menu {
      display: none;
    }
    .nav-menu {
      list-style: none;
      display: flex;
      flex-direction: column;
    }
    .nav-menu li {
      padding: 12px 15px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #333;
      transition: all 0.2s;
    }
    .nav-menu li:hover {
      background: #efefef;
      color: #1976d2;
    }
    .nav-menu li.is-active {
      background: #e3f2fd;
      color: #1976d2;
      font-weight: 600;
      border-left: 3px solid #1976d2;
      padding-left: 12px;
    }
    .nav-menu li.is-disabled {
      opacity: 0.5;
      cursor: not-allowed;
      color: #999;
    }
    .nav-menu li.is-disabled:hover {
      background: #f5f5f5;
      color: #999;
    }
    .nav-icon-01::before { content: "ğŸ“¢"; margin-right: 4px; }
    .nav-icon-08::before { content: "ğŸ”"; margin-right: 4px; }
    .nav-icon-06::before { content: "ğŸ“‹"; margin-right: 4px; }
    .nav-icon-04::before { content: "ğŸ“"; margin-right: 4px; }

    /* ì˜¤ë¥¸ìª½ ì½˜í…ì¸  */
    .contents {
      flex: 1;
      background: #fff;
      overflow: auto;
    }

    /* ëª¨ë‹¬ */
    #timer-modal,
    #freshman-basket-modal {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #timer-modal > div,
    #freshman-basket-modal > div {
      background: #fff;
      padding: 40px;
      border-radius: 4px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      text-align: center;
      min-width: 300px;
    }
    #timer-modal .title,
    #freshman-basket-modal .title { font-size: 18px; font-weight: bold; color: #d32f2f; margin-bottom: 12px; }
    #timer-modal .message,
    #freshman-basket-modal .message { font-size: 13px; color: #333; margin-bottom: 24px; line-height: 1.6; }
    #timer-modal button,
    #freshman-basket-modal button {
      width: 100%;
      height: 36px;
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    /* íƒ€ì´ë¨¸ ì„¤ì • ì˜ì—­ */
    #timer-section {
      background: #fafafa;
      border-bottom: 1px solid #ddd;
      padding: 10px 20px;
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 12px;
    }
    #timer-section label {
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    #timer-section input {
      width: 45px;
      padding: 5px;
      border: 1px solid #bbb;
      text-align: center;
      border-radius: 2px;
      font-size: 11px;
    }
    #timer-section button {
      padding: 5px 12px;
      border: none;
      border-radius: 2px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
    }
    #set-timer-btn { background: #1976d2; color: #fff; }
    #set-timer-btn:hover { background: #1565c0; }
    #reset-btn { background: #d32f2f; color: #fff; }
    #reset-btn:hover { background: #c62828; }
    #timer-status { color: #888; margin-left: auto; font-size: 11px; }

    /* íƒ­ */
    .sw-tabs {
      list-style: none;
      display: flex;
      border-bottom: 2px solid #ddd;
      background: #fafafa;
      padding: 0;
      margin: 0;
    }
    .sw-tabs li {
      padding: 10px 20px;
      cursor: pointer;
      border-right: 1px solid #ddd;
      font-size: 12px;
      transition: all 0.2s;
    }
    .sw-tabs li:last-child { border-right: none; }
    .sw-tabs li:hover { background: #f0f0f0; }
    .sw-tabs li.is-active {
      background: #fff;
      color: #1976d2;
      font-weight: 600;
      border-bottom: 2px solid #1976d2;
      margin-bottom: -2px;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <!-- íƒ€ì´ë¨¸ ë¯¸ê°œì‹œ ëª¨ë‹¬ -->
  <div id="timer-modal" style="display: none;">
    <div>
      <div class="title">â± ìˆ˜ê°•ì‹ ì²­ ë¯¸ê°œì‹œ</div>
      <div class="message">ì•„ì§ ìˆ˜ê°•ì‹ ì²­ì´ ì—´ë¦¬ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ìƒë‹¨ íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•œ í›„<br>ì‹œê°„ì´ ë˜ë©´ ì ‘ê·¼í•´ì£¼ì„¸ìš”.</div>
      <button onclick="document.getElementById('timer-modal').style.display='none'">í™•ì¸</button>
    </div>
  </div>

  <!-- 1í•™ë…„ ì˜ˆë¹„ìˆ˜ê°• ì œí•œ ëª¨ë‹¬ -->
  <div id="freshman-basket-modal" style="display: none;">
    <div>
      <div class="title">âš ï¸ ê¸°ëŠ¥ ì œí•œ</div>
      <div class="message">1í•™ë…„ 1í•™ê¸°ì—ëŠ” ì˜ˆë¹„ìˆ˜ê°•ì‹ ì²­ ê¸°ëŠ¥ì„ ì‚¬ìš©í• ìˆ˜ì—†ìŠµë‹ˆë‹¤.</div>
      <button onclick="document.getElementById('freshman-basket-modal').style.display='none'">í™•ì¸</button>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settings-modal" style="display: none;">
    <div>
      <div class="title">âš™ï¸ ì„¤ì •</div>
      <div class="settings-item">
        <label for="queue-toggle">ëŒ€ê¸°ì—´</label>
        <label class="toggle-switch">
          <input type="checkbox" id="queue-toggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="settings-item">
        <label for="grade-select">í•™ë…„</label>
        <select id="grade-select" class="grade-select">
          <option value="1">1í•™ë…„</option>
          <option value="2" selected>2í•™ë…„</option>
          <option value="3">3í•™ë…„</option>
          <option value="4">4í•™ë…„</option>
        </select>
      </div>
      <div id="settings-modal-buttons">
        <button class="cancel-btn" onclick="document.getElementById('settings-modal').style.display='none'">ë‹«ê¸°</button>
        <button class="confirm-btn" onclick="saveSettings()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- í—¤ë” -->
    <div class="header">
      <div class="is-left">
        <span>2026ë…„ë„ 1í•™ê¸°</span>
        <span class="title">
          ì‹œê°„ : <span id="server-time">2026-02-10 15:33:42</span>
        </span>
      </div>
      <div class="is-right">
        <button class="settings-btn" onclick="document.getElementById('settings-modal').style.display='flex'" title="ì„¤ì •">âš™ï¸</button>
      </div>
    </div>

    <!-- íƒ€ì´ë¨¸ ì„¤ì • -->
    <div id="timer-section">
      <label>
        <span style="font-weight:600;">ì˜¤í”ˆ ì‹œê°„:</span>
        <input type="number" id="timer-hour" min="0" max="23" value="0" placeholder="ì‹œ">
        <span>:</span>
        <input type="number" id="timer-min" min="0" max="59" value="0" placeholder="ë¶„">
        <span>:</span>
        <input type="number" id="timer-sec" min="0" max="59" value="0" placeholder="ì´ˆ">
      </label>
      <button id="set-timer-btn">ì„¤ì •</button>
      <button id="reset-btn">ì´ˆê¸°í™”</button>
      <span id="timer-status"></span>
    </div>

    <!-- ë°”ë”” (ë„¤ë¹„ê²Œì´ì…˜ + ì½˜í…ì¸ ) -->
    <div class="body">
      <!-- ì™¼ìª½ ë„¤ë¹„ê²Œì´ì…˜ -->
      <div class="nav">
        <ul class="nav-menu">
          <li class="is-active" data-page="notice">
            <i class="nav-icon-01"></i><span>ê³µì§€ì‚¬í•­</span>
          </li>
          <li data-page="subject">
            <i class="nav-icon-08"></i><span>ì¡°íšŒ</span>
          </li>
          <li data-page="basket">
            <i class="nav-icon-06"></i><span>ì˜ˆë¹„ìˆ˜ê°•</span>
          </li>
          <li data-page="register">
            <i class="nav-icon-04"></i><span>ìˆ˜ê°•ì‹ ì²­</span>
          </li>
        </ul>
      </div>

      <!-- ì˜¤ë¥¸ìª½ ì½˜í…ì¸  -->
      <div class="contents">
        <iframe id="main-frame" src="front/notice.html"></iframe>
      </div>
    </div>
  </div>

  <script>
    const tabMap = {
      notice: 'front/notice.html',
      subject: 'front/subject.html',
      basket: 'front/basket.html',
      register: 'front/register.html'
    };

    let timerInterval = null;
    window.globalOpenTime = null;

    // ë„¤ë¹„ê²Œì´ì…˜ í´ë¦­
    document.querySelectorAll('.nav-menu li').forEach(li => {
      li.onclick = function() {
        const pageType = this.dataset.page;
        
        // 1í•™ë…„ ì˜ˆë¹„ìˆ˜ê°• ì œí•œ ì²´í¬
        if (pageType === 'basket') {
          const grade = localStorage.getItem('userGrade') || '2';
          if (grade === '1') {
            document.getElementById('freshman-basket-modal').style.display = 'flex';
            return;
          }
        }
        
        // ë¹„í™œì„±í™”ëœ ë©”ë‰´ëŠ” í´ë¦­ ë¶ˆê°€
        if (this.classList.contains('is-disabled')) {
          return;
        }
        
        if (pageType === 'register' && !window.globalOpenTime) {
          document.getElementById('timer-modal').style.display = 'flex';
          return;
        }

        document.querySelectorAll('.nav-menu li').forEach(l => l.classList.remove('is-active'));
        this.classList.add('is-active');
        document.getElementById('main-frame').src = tabMap[pageType];
      };
    });

    // íƒ€ì´ë¨¸ ì„¤ì •
    document.getElementById('set-timer-btn').onclick = function() {
      const hour = parseInt(document.getElementById('timer-hour').value, 10) || 0;
      const min = parseInt(document.getElementById('timer-min').value, 10) || 0;
      const sec = parseInt(document.getElementById('timer-sec').value, 10) || 0;

      const now = new Date();
      let openHour = now.getHours() + hour;
      let openMin = now.getMinutes() + min;
      let openSec = now.getSeconds() + sec;

      if (openSec >= 60) {
        openMin += Math.floor(openSec / 60);
        openSec = openSec % 60;
      }
      if (openMin >= 60) {
        openHour += Math.floor(openMin / 60);
        openMin = openMin % 60;
      }
      if (openHour >= 24) {
        openHour = openHour % 24;
      }

      const newOpenTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), openHour, openMin, openSec);
      if (newOpenTime <= now) {
        newOpenTime.setDate(newOpenTime.getDate() + 1);
      }

      window.globalOpenTime = newOpenTime;
      if (timerInterval) clearInterval(timerInterval);
      updateTimer();
    };

    // ì´ˆê¸°í™”
    document.getElementById('reset-btn').onclick = function() {
      localStorage.removeItem('registerList');
      localStorage.removeItem('basketList');
      window.globalOpenTime = null;
      if (timerInterval) clearInterval(timerInterval);
      
      const timerDisplay = document.getElementById('timer-display');
      const timerStatus = document.getElementById('timer-status');
      if (timerDisplay) timerDisplay.textContent = 'ì„¤ì • í•„ìš”';
      if (timerStatus) timerStatus.textContent = '';
    };

    // ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸ (í•™ë…„ì— ë”°ë¼ ë©”ë‰´ í™œì„±/ë¹„í™œì„±í™”)
    function updateNavigation() {
      const grade = localStorage.getItem('userGrade') || '2';
      const basketMenu = document.querySelector('[data-page="basket"]');
      
      if (grade === '1') {
        // 1í•™ë…„ì´ë©´ ì˜ˆë¹„ìˆ˜ê°• ë©”ë‰´ ë¹„í™œì„±í™”
        basketMenu.classList.add('is-disabled');
      } else {
        // 1í•™ë…„ì´ ì•„ë‹ˆë©´ ì˜ˆë¹„ìˆ˜ê°• ë©”ë‰´ í™œì„±í™”
        basketMenu.classList.remove('is-disabled');
      }
    }

    // ì„¤ì • ì €ì¥
    function saveSettings() {
      const queueEnabled = document.getElementById('queue-toggle').checked;
      const grade = document.getElementById('grade-select').value;
      
      localStorage.setItem('queueEnabled', JSON.stringify(queueEnabled));
      localStorage.setItem('userGrade', grade);
      
      updateNavigation();
      
      alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      document.getElementById('settings-modal').style.display = 'none';
    }

    // ì„¤ì • ë¡œë“œ
    function loadSettings() {
      const queueEnabled = JSON.parse(localStorage.getItem('queueEnabled') || 'false');
      const grade = localStorage.getItem('userGrade') || '2';
      
      document.getElementById('queue-toggle').checked = queueEnabled;
      document.getElementById('grade-select').value = grade;
    }

    // ì´ˆê¸° ì„¤ì • ë¡œë“œ ë° ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
    loadSettings();
    updateNavigation();

    // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
    function updateTimer() {
      if (!window.globalOpenTime) return;
      const timerDisplay = document.getElementById('timer-display');
      const timerStatus = document.getElementById('timer-status');
      if (!timerDisplay || !timerStatus) return;
      
      const update = () => {
        const now = new Date();
        let diff = Math.floor((window.globalOpenTime - now) / 1000);
        
        if (diff <= 0) {
          clearInterval(timerInterval);
          timerDisplay.textContent = '00:00 (ì˜¤í”ˆë¨)';
          timerStatus.textContent = '';
        } else {
          const h = Math.floor(diff / 3600);
          const m = Math.floor((diff % 3600) / 60);
          const s = diff % 60;
          timerDisplay.textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }
      };
      
      update();
      timerInterval = setInterval(update, 500);
    }

    // ì´ í•™ì  ì—…ë°ì´íŠ¸
    function updateTotalCredit() {
      try {
        const elem = document.getElementById('total-credit');
        if (elem) {
          const registerList = JSON.parse(localStorage.getItem('registerList') || '[]');
          const totalCredit = registerList.reduce((sum, course) => sum + parseInt(course.credit, 10), 0);
          elem.textContent = totalCredit;
        }
      } catch (e) {
        console.error('Credit error:', e);
      }
    }

    // ì„œë²„ ì‹œê°„ í‘œì‹œ (í˜„ì¬ ì‹œê°„)
    function updateServerTime() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const date = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('server-time').textContent = `${year}-${month}-${date} ${hours}:${minutes}:${seconds}`;
    }

    updateServerTime();
    setInterval(updateServerTime, 1000);
    setInterval(updateTotalCredit, 500);
    updateTotalCredit();
  </script>
</body>
</html>